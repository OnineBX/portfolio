var pageVisibility=function(){var o=null,n=function(o,n){return""!==o?o+n.slice(0,1).toUpperCase()+n.slice(1):n},t=function(){var t=!1;return"number"==typeof window.screenX&&["webkit","moz","ms","o",""].forEach(function(e){t===!1&&void 0!==document[n(e,"hidden")]&&(o=e,t=!0)}),t}(),e=function(){return t?document[n(o,"hidden")]:void 0},i=function(){return t?document[n(o,"visibilityState")]:void 0};return{hidden:e(),visibilityState:i(),visibilitychange:function(n,c){return c=!1,t&&"function"==typeof n?document.addEventListener(o+"visibilitychange",function(o){this.hidden=e(),this.visibilityState=i(),n.call(this,o)}.bind(this),c):void 0}}}(void 0);window.console||(window.console={log:function(){},warn:function(){}}),function(){if(!window.skt){var o;window.$?o=window.$:window.require&&(o=require("base:widget/libs/jquerypacket.js"));var n={eventPool:{},pollingPool:{},callbackPool:{},socket:null,reconnectNum:0,maxReconnect:2,outTime:6e4,pollingErrorTimes:3,pllingBackTime:(new Date).getTime()},t={checkInBaiduCompany:function(){return!1},supportWebSocket:function(){return!(!window.WebSocket&&!window.MozWebSocket)},isLogin:function(){var o=window.navigator&&""!==window.navigator.userAgent,n=/BAIDUID/.test(document.cookie),t=window.yunData&&"1"===String(window.yunData.LOGINSTATUS)||"1"===String(window.yunData.loginstate)||window.FileUtils&&"1"===String(window.FileUtils.loginState)||window.locals&&1===+window.locals.get("loginstate");return!!(o&&t&&n)},sendDiskLog:function(o){window.socketLog=new Image;var n=window.socketLog,t="/api/analytics?_lsid="+(new Date).getTime()+"&_lsix=1";t+="&type="+o,n.src=t,n.onload=n.onerror=function(){window.socketLog=null},n=null}},e={onloaded:function(){}};window.skt=e;var i=function(){window.skt.diskSocket?n.socket=window.skt.diskSocket:t.checkInBaiduCompany()&&-1!==location.search.indexOf("stopsocket=true")?console.log("[LOG FROM SOCKET] DEBUG stop socket for company"):-1!==location.search.indexOf("outsidestopsocket=true")?console.log("[LOG FROM SOCKET] DEBUG stop socket for outer"):n.buildSocket()};n.buildSocket=function(){if(t.isLogin()){var i=location.protocol+"//",c=[];c.push(t.supportWebSocket()?"websocket":"polling"),o.loadScript("https://pannss.bdstatic.com/m-static/base/js/lib/socket.io.new.js",function(){e.diskSocket=n.socket=window.io.connect(i+"webpush.pan.baidu.com?appid=6163836",{reconnection:!1,reconnectionAttempts:3,transports:c}),n.initActive(),n.initMsg(),n.initOther(),e.onloaded()})}},n.initActive=function(){setTimeout(function(){n.socket.emit("active","heartbeat,from_client"),t.checkInBaiduCompany()&&console.log("[LOG FROM SOCKET] send heartbeat to server first.")},2e3);var o,e=function(){o=setInterval(function(){if(!n.socket.status)try{clearInterval(o)}catch(t){}n.socket.emit("active","heartbeat,from_client")},18e5)};e(),"undefined"!=typeof pageVisibility.hidden&&pageVisibility.visibilitychange(function(){if(this.hidden)try{clearInterval(o)}catch(i){}else t.checkInBaiduCompany()&&console.log("[LOG FROM SOCKET] tab is in front and will send heartbeat."),n.socket.emit("active","heartbeat,from_client"),e(),n.polling(!0)})},n.initMsg=function(){n.socket.on("msg",function(e){if(t.checkInBaiduCompany()&&console.log("[LOG FROM SOCKET] there is a msg from server: ",e),"string"==typeof e&&(o&&o.parseJSON?e=o.parseJSON(e):JSON&&(e=JSON.parse(e))),"string"==typeof e.content&&(o&&o.parseJSON?e.content=o.parseJSON(e.content):JSON&&(e.content=JSON.parse(e.content))),"callback"===e.type)"function"==typeof n.callbackPool[e.content.pushid]&&n.callbackPool[e.content.pushid].call(null,e.content.result);else if("object"==typeof n.eventPool[e.type]&&n.eventPool[e.type].length)for(var i=n.eventPool[e.type],c=0,l=i.length;l>c;c++)"function"==typeof i[c]&&i[c].call(null,e.content)})},n.initOther=function(){n.socket.on("connect",function(){n.socket.status=!0,n.reconnectNum=0,t.sendDiskLog("socket-connected"),t.checkInBaiduCompany()&&console.log("[LOG FROM SOCKET] socket is connected success")}),n.socket.on("disconnect",function(){t.sendDiskLog("socket-broken"),t.checkInBaiduCompany()&&console.log("[LOG FROM SOCKET] socket connect is broken."),n.socket.status=!1,setTimeout(n.polling,n.outTime),n.reconnectNum>=n.maxReconnect||n.randomReconnectSocket()}),n.socket.on("connect_failed",function(){n.socket.status=!1,t.sendDiskLog("socket-cennect-failed"),t.checkInBaiduCompany()&&console.warn("[LOG FROM SOCKET] socket can not be connected."),setTimeout(n.polling,n.outTime),n.reconnectNum>=n.maxReconnect||n.randomReconnectSocket()})},n.randomReconnectSocket=function(){var o=parseInt(6*Math.random()*1e3,10);setTimeout(function(){n.reconnectNum++,t.checkInBaiduCompany()&&console.log("[LOG FROM SOCKET] reconnect the socket........"),t.sendDiskLog("socket-reconnect"),n.socket.emit("active","heartbeat,from_client"),e.diskSocket.io.reconnect()},o)},n.pollingEnd=function(){n.pllingBackTime=(new Date).getTime()},n.polling=function(o,e){if(!o&&n.socket&&n.socket.status)return void(n.polling.status=!1);if((new Date).getTime()-n.pllingBackTime>n.pollingErrorTimes*n.outTime)return void(t.checkInBaiduCompany()&&console.log("[LOG FROM SOCKET] connet timeout, stop polling ! "));!o&&n.polling.status&&(n.polling.num="number"==typeof n.polling.num?++n.polling.num:1,1===n.polling.num&&(t.checkInBaiduCompany()&&console.log("[LOG FROM SOCKET] socket is stopped, start polling ----- "),t.sendDiskLog("socket-start-polling")),t.checkInBaiduCompany()&&console.log("[LOG FROM SOCKET] polling num: "+ +n.polling.num));for(var i in n.pollingPool)if((!e||i===e)&&(t.checkInBaiduCompany()&&console.log("[LOG FROM SOCKET] polling the api for "+i),n.pollingPool[i].length))for(var c=n.pollingPool[i],l=0,s=c.length;s>l;l++)"function"==typeof c[l]&&c[l].call(null,{refresh:o,callback:n.pollingEnd});n.polling.status||(n.polling.status=!0);try{clearTimeout(n.polling.timeout)}catch(a){}n.polling.timeout=setTimeout(n.polling,n.outTime)},n.sendMsg=function(o,t,e,i){if(n.socket.status){var c={type:"callback",content:{api:t,pushid:o,method:e}};"post"===e&&(c.content.param=i),n.socket.emit("callback",c)}},n.getRandomId=function(){var o=(new Date).getTime();return"m"+o},n.getUrlParam=function(o){var n={};if(-1===o.indexOf("?")||-1===o.indexOf("=")||-1!==o.indexOf("#"))return n;for(var t=o.substring(o.indexOf("?")),e=t.split("&"),i=0,c=e.length;c>i;i++){var l=e[i].split("=");l[0]&&l[1]&&(n[l[0]]=l[1])}return n},n.setUrlParam=function(o,n){for(var t in n)n.hasOwnProperty(t)&&(o+=-1===o.indexOf("?")?"?":"&",o+=t+"="+n[t])},e.on=function(o,t,e){"string"==typeof o&&("object"==typeof n.eventPool[o]&&n.eventPool[o].length?n.eventPool[o].push(t):n.eventPool[o]=[t],"function"==typeof e&&("object"==typeof n.pollingPool[o]&&n.pollingPool[o].length?n.pollingPool[o].push(e):n.pollingPool[o]=[e])),n.polling(!0,o)},e.die=function(o,t){if("string"==typeof o&&Array.isArray(n.eventPool[o]))for(var e=n.eventPool[o],i=0,c=e.length;c>i;i++)if(e===t||e.toString()===t.toString()){e.splice(i,1);break}},e.post=function(t,e,i){if(!n.status)return void o.post(t,e,i).error(i);e=o.extend(e,n.getUrlParam(t));var c=n.getRandomId();n.callbackPool[c]=i,n.sendMsg(c,t,"post",e)},e.get=function(t,e,i){if(!n.status)return void o.get(t,e,i).error(i);t=n.setUrlParam(t,e);var c=n.getRandomId();n.callbackPool[c]=i,n.sendMsg(c,t,"get")},i()}}();