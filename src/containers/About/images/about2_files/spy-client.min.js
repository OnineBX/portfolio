!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).SpyClient=e()}(this,function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(t){return t&&t.Math==Math&&t}function a(t){try{return!!t()}catch(t){return!0}}function o(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function r(t){return b.call(t).slice(8,-1)}function i(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function u(t){return k(i(t))}function c(t){return"object"==typeof t?null!==t:"function"==typeof t}function f(t,e){if(!c(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!c(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!c(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!c(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function s(t,e){return O.call(t,e)}function l(t){return j?E.createElement(t):{}}function p(t){if(!c(t))throw TypeError(String(t)+" is not an object");return t}function d(e,n){try{T(h,e,n)}catch(t){h[e]=n}return n}var h=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")(),v=!a(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),y={}.propertyIsEnumerable,m=Object.getOwnPropertyDescriptor,g={f:m&&!y.call({1:2},1)?function(t){var e=m(this,t);return!!e&&e.enumerable}:y},b={}.toString,w="".split,k=a(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==r(t)?w.call(t,""):Object(t)}:Object,O={}.hasOwnProperty,E=h.document,j=c(E)&&c(E.createElement),S=!v&&!a(function(){return 7!=Object.defineProperty(l("div"),"a",{get:function(){return 7}}).a}),C=Object.getOwnPropertyDescriptor,x={f:v?C:function(t,e){if(t=u(t),e=f(e,!0),S)try{return C(t,e)}catch(t){}if(s(t,e))return o(!g.f.call(t,e),t[e])}},A=Object.defineProperty,P={f:v?A:function(t,e,n){if(p(t),e=f(e,!0),p(n),S)try{return A(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},T=v?function(t,e,n){return P.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t},M="__core-js_shared__",L=h[M]||d(M,{}),I=Function.toString;"function"!=typeof L.inspectSource&&(L.inspectSource=function(t){return I.call(t)});function _(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++W+B).toString(36)}function D(t){return U[t]||(U[t]=_(t))}var F,z,N,R=L.inspectSource,Z=h.WeakMap,q="function"==typeof Z&&/native code/.test(R(Z)),G=e(function(t){(t.exports=function(t,e){return L[t]||(L[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.4",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})}),W=0,B=Math.random(),U=G("keys"),K={},$=h.WeakMap;if(q){var J=new $,Q=J.get,V=J.has,X=J.set;F=function(t,e){return X.call(J,t,e),e},z=function(t){return Q.call(J,t)||{}},N=function(t){return V.call(J,t)}}else{var Y=D("state");K[Y]=!0,F=function(t,e){return T(t,Y,e),e},z=function(t){return s(t,Y)?t[Y]:{}},N=function(t){return s(t,Y)}}function H(t){return"function"==typeof t?t:void 0}function tt(t,e){return arguments.length<2?H(yt[t])||H(h[t]):yt[t]&&yt[t][e]||h[t]&&h[t][e]}function et(t){return isNaN(t=+t)?0:(0<t?gt:mt)(t)}function nt(t){return 0<t?bt(et(t),9007199254740991):0}function rt(c){return function(t,e,n){var r,o=u(t),i=nt(o.length),a=function(t,e){var n=et(t);return n<0?wt(n+e,0):kt(n,e)}(n,i);if(c&&e!=e){for(;a<i;)if((r=o[a++])!=r)return!0}else for(;a<i;a++)if((c||a in o)&&o[a]===e)return c||a||0;return!c&&-1}}function ot(t,e){var n,r=u(t),o=0,i=[];for(n in r)!s(K,n)&&s(r,n)&&i.push(n);for(;e.length>o;)s(r,n=e[o++])&&(~Et(i,n)||i.push(n));return i}function it(t,e){for(var n=At(e),r=P.f,o=x.f,i=0;i<n.length;i++){var a=n[i];s(t,a)||r(t,a,o(e,a))}}function at(t,e){var n=Mt[Tt(t)];return n==It||n!=Lt&&("function"==typeof e?a(e):!!e)}function ct(t,e){var n,r,o,i,a,c=t.target,u=t.global,f=t.stat;if(n=u?h:f?h[c]||d(c,{}):(h[c]||{}).prototype)for(r in e){if(i=e[r],o=t.noTargetGet?(a=Dt(n,r))&&a.value:n[r],!_t(u?r:c+(f?".":"#")+r,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;it(i,o)}(t.sham||o&&o.sham)&&T(i,"sham",!0),vt(n,r,i,t)}}function ut(t){return Object(i(t))}function ft(t,e,n){var r=f(e);r in t?P.f(t,r,o(0,n)):t[r]=n}function st(t){return s(Rt,t)||(zt&&s(Zt,t)?Rt[t]=Zt[t]:Rt[t]=qt("Symbol."+t)),Rt[t]}function lt(t,e){var n;return Ft(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Ft(n.prototype)?c(n)&&null===(n=n[Gt])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}var pt,dt,ht={set:F,get:z,has:N,enforce:function(t){return N(t)?z(t):F(t,{})},getterFor:function(n){return function(t){var e;if(!c(t)||(e=z(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},vt=e(function(t){var e=ht.get,c=ht.enforce,u=String(String).split("String");(t.exports=function(t,e,n,r){var o=!!r&&!!r.unsafe,i=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||s(n,"name")||T(n,"name",e),c(n).source=u.join("string"==typeof e?e:"")),t!==h?(o?!a&&t[e]&&(i=!0):delete t[e],i?t[e]=n:T(t,e,n)):i?t[e]=n:d(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||R(this)})}),yt=h,mt=Math.ceil,gt=Math.floor,bt=Math.min,wt=Math.max,kt=Math.min,Ot={includes:rt(!0),indexOf:rt(!1)},Et=Ot.indexOf,jt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],St=jt.concat("length","prototype"),Ct={f:Object.getOwnPropertyNames||function(t){return ot(t,St)}},xt={f:Object.getOwnPropertySymbols},At=tt("Reflect","ownKeys")||function(t){var e=Ct.f(p(t)),n=xt.f;return n?e.concat(n(t)):e},Pt=/#|\.prototype\./,Tt=at.normalize=function(t){return String(t).replace(Pt,".").toLowerCase()},Mt=at.data={},Lt=at.NATIVE="N",It=at.POLYFILL="P",_t=at,Dt=x.f,Ft=Array.isArray||function(t){return"Array"==r(t)},zt=!!Object.getOwnPropertySymbols&&!a(function(){return!String(Symbol())}),Nt=zt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Rt=G("wks"),Zt=h.Symbol,qt=Nt?Zt:Zt&&Zt.withoutSetter||_,Gt=st("species"),Wt=tt("navigator","userAgent")||"",Bt=h.process,Ut=Bt&&Bt.versions,Kt=Ut&&Ut.v8;Kt?dt=(pt=Kt.split("."))[0]+pt[1]:Wt&&(!(pt=Wt.match(/Edge\/(\d+)/))||74<=pt[1])&&(pt=Wt.match(/Chrome\/(\d+)/))&&(dt=pt[1]);function $t(e){return 51<=Qt||!a(function(){var t=[];return(t.constructor={})[Vt]=function(){return{foo:1}},1!==t[e](Boolean).foo})}function Jt(t){if(!c(t))return!1;var e=t[Xt];return void 0!==e?!!e:Ft(t)}var Qt=dt&&+dt,Vt=st("species"),Xt=st("isConcatSpreadable"),Yt=9007199254740991,Ht="Maximum allowed index exceeded",te=51<=Qt||!a(function(){var t=[];return t[Xt]=!1,t.concat()[0]!==t}),ee=$t("concat");ct({target:"Array",proto:!0,forced:!te||!ee},{concat:function(t){var e,n,r,o,i,a=ut(this),c=lt(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(Jt(i=-1===e?a:arguments[e])){if(o=nt(i.length),Yt<u+o)throw TypeError(Ht);for(n=0;n<o;n++,u++)n in i&&ft(c,u,i[n])}else{if(Yt<=u)throw TypeError(Ht);ft(c,u++,i)}return c.length=u,c}});function ne(){}function re(t){return"<script>"+t+"</"+fe+">"}var oe,ie=Object.keys||function(t){return ot(t,jt)},ae=v?Object.defineProperties:function(t,e){p(t);for(var n,r=ie(e),o=r.length,i=0;i<o;)P.f(t,n=r[i++],e[n]);return t},ce=tt("document","documentElement"),ue="prototype",fe="script",se=D("IE_PROTO"),le=function(){try{oe=document.domain&&new ActiveXObject("htmlfile")}catch(t){}le=oe?function(t){t.write(re("")),t.close();var e=t.parentWindow.Object;return t=null,e}(oe):function(){var t,e=l("iframe");return e.style.display="none",ce.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(re("document.F=Object")),t.close(),t.F}();for(var t=jt.length;t--;)delete le[ue][jt[t]];return le()};K[se]=!0;var pe=Object.create||function(t,e){var n;return null!==t?(ne[ue]=p(t),n=new ne,ne[ue]=null,n[se]=t):n=le(),void 0===e?n:ae(n,e)},de=st("unscopables"),he=Array.prototype;null==he[de]&&P.f(he,de,{configurable:!0,value:pe(null)});function ve(t){throw t}function ye(t,e){if(s(be,t))return be[t];var n=[][t],r=!!s(e=e||{},"ACCESSORS")&&e.ACCESSORS,o=s(e,0)?e[0]:ve,i=s(e,1)?e[1]:void 0;return be[t]=!!n&&!a(function(){if(r&&!v)return!0;var t={length:-1};r?ge(t,1,{enumerable:!0,get:ve}):t[1]=1,n.call(t,o,i)})}var me,ge=Object.defineProperty,be={},we=Ot.includes;ct({target:"Array",proto:!0,forced:!ye("indexOf",{ACCESSORS:!0,1:0})},{includes:function(t,e){return we(this,t,1<arguments.length?e:void 0)}}),me="includes",he[de][me]=!0;var ke,Oe,Ee=[].join,je=k!=Object,Se=(ke=",",!!(Oe=[]["join"])&&a(function(){Oe.call(null,ke||function(){throw 1},1)}));ct({target:"Array",proto:!0,forced:je||!Se},{join:function(t){return Ee.call(u(this),void 0===t?",":t)}});function Ce(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function xe(d){var h=1==d,v=2==d,y=3==d,m=4==d,g=6==d,b=5==d||g;return function(t,e,n,r){for(var o,i,a=ut(t),c=k(a),u=function(r,o,t){if(Ce(r),void 0===o)return r;switch(t){case 0:return function(){return r.call(o)};case 1:return function(t){return r.call(o,t)};case 2:return function(t,e){return r.call(o,t,e)};case 3:return function(t,e,n){return r.call(o,t,e,n)}}return function(){return r.apply(o,arguments)}}(e,n,3),f=nt(c.length),s=0,l=r||lt,p=h?l(t,f):v?l(t,0):void 0;s<f;s++)if((b||s in c)&&(i=u(o=c[s],s,a),d))if(h)p[s]=i;else if(i)switch(d){case 3:return!0;case 5:return o;case 6:return s;case 2:Ae.call(p,o)}else if(m)return!1;return g?-1:y||m?m:p}}var Ae=[].push,Pe={forEach:xe(0),map:xe(1),filter:xe(2),some:xe(3),every:xe(4),find:xe(5),findIndex:xe(6)}.map,Te=$t("map"),Me=ye("map");ct({target:"Array",proto:!0,forced:!Te||!Me},{map:function(t,e){return Pe(this,t,1<arguments.length?e:void 0)}}),ct({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}});var Le=Date.prototype,Ie="Invalid Date",_e="toString",De=Le[_e],Fe=Le.getTime;new Date(NaN)+""!=Ie&&vt(Le,_e,function(){var t=Fe.call(this);return t==t?De.call(this):Ie});var ze=[].slice,Ne={};ct({target:"Function",proto:!0},{bind:Function.bind||function(e){var n=Ce(this),r=ze.call(arguments,1),o=function(){var t=r.concat(ze.call(arguments));return this instanceof o?function(t,e,n){if(!(e in Ne)){for(var r=[],o=0;o<e;o++)r[o]="a["+o+"]";Ne[e]=Function("C,a","return new C("+r.join(",")+")")}return Ne[e](t,n)}(n,t.length,t):n.apply(e,t)};return c(n.prototype)&&(o.prototype=n.prototype),o}});var Re=Object.assign,Ze=Object.defineProperty,qe=!Re||a(function(){if(v&&1!==Re({b:1},Re(Ze({},"a",{enumerable:!0,get:function(){Ze(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Re({},t)[n]||ie(Re({},e)).join("")!=r})?function(t,e){for(var n=ut(t),r=arguments.length,o=1,i=xt.f,a=g.f;o<r;)for(var c,u=k(arguments[o++]),f=i?ie(u).concat(i(u)):ie(u),s=f.length,l=0;l<s;)c=f[l++],v&&!a.call(u,c)||(n[c]=u[c]);return n}:Re;ct({target:"Object",stat:!0,forced:Object.assign!==qe},{assign:qe}),ct({target:"Object",stat:!0,forced:a(function(){ie(1)})},{keys:function(t){return ie(ut(t))}});function Ge(o){return function(t,e){var n=2<arguments.length,r=n?We.call(arguments,2):void 0;return o(n?function(){("function"==typeof t?t:Function(t)).apply(this,r)}:t,e)}}var We=[].slice;function Be(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}ct({global:!0,bind:!0,forced:/MSIE .\./.test(Wt)},{setTimeout:Ge(h.setTimeout),setInterval:Ge(h.setInterval)});var Ue,Ke,$e,Je="http:"===location.protocol?"http://sestat.baidu.com/mwb2.gif?":"https://sp1.baidu.com/5b1ZeDe5KgQFm2e88IuM_a/mwb2.gif?",Qe=/(iPhone|iPod|iPad)/.test(navigator.userAgent);function Ve(t){console.error("[SpyClient_log]".concat(t))}function Xe(t){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Xe),this.sample={},this.markCache={},this.listenErrorOption={},this.globalErrorCallback=this.globalErrorCallback.bind(this),!t.pid)throw new Error("pid is required");this.option={pid:t.pid,lid:t.lid,check:!1!==t.check,sample:t.sample}}return Ue=Xe,(Ke=[{key:"send",value:function(t){if(this.check(t)){if("number"==typeof t.sample){if(Math.random()>t.sample)return}else if("number"==typeof this.option.sample&&Math.random()>this.option.sample)return;delete t.sample,t=Object.assign({pid:this.option.pid,lid:this.option.lid,ts:Date.now(),group:"common"},t);var e=Je+function(n){return Object.keys(n).map(function(t){var e=n[t];return void 0===e?e="":"string"!=typeof e&&(e=JSON.stringify(e)),encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")}(t);!Qe&&navigator.sendBeacon&&navigator.sendBeacon(e)||((new Image).src=e)}}},{key:"check",value:function(t){if(!this.option.check)return!0;var e=["perf","except","dist","count"];if(!e.includes(t.type))return Ve("type only is one of "+e.join(", ")),!1;if(t.group&&30<t.group.length)return Ve("group length execeeds 30"),!1;var n=/^[a-zA-Z0-9-_]{0,30}$/;if("except"===t.type){if("string"!=typeof t.info.msg||!t.info.msg.length)return Ve("info msg field must be not empty and is String"),!1}else for(var r=0,o=Object.keys(t.info);r<o.length;r++){var i=o[r];if(!n.test(i))return Ve("info key [".concat(i,"] is unexpected. ")+"Length must be not more than 30. Supported chars: a-zA-Z0-9-_"),!1;var a=t.info[i];if("dist"===t.type){if(30<a.length)return Ve("info.".concat(i," value length execeeds 30 when type == 'dist'")),!1}else if("number"!=typeof a)return Ve("info.".concat(i," value must be number")),!1}if(t.dim)for(var c=0,u=Object.keys(t.dim);c<u.length;c++){var f=u[c];if(!n.test(f))return Ve("dim key [".concat(f,"] is unexpected. ")+"Length must be not more than 30. Supported chars: a-zA-Z0-9-_"),!1;var s=t.dim[f];if(!/^[a-zA-Z0-9\-_\*\.\s\/#\+@\&\u4e00-\u9fa5]{0,30}$/.test(s))return Ve("dim.".concat(f," value [").concat(s,"] is unexpected. ")+"Length must be not more than 30. Supported chars: a-zA-Z0-9-_*. /#+@& and Chinese"),!1}return!0}},{key:"sendPerf",value:function(t){this.send(Object.assign({type:"perf"},t))}},{key:"sendExcept",value:function(t){this.send(Object.assign({type:"except"},t))}},{key:"sendDist",value:function(t){this.send(Object.assign({type:"dist"},t))}},{key:"sendCount",value:function(t){this.send(Object.assign({type:"count"},t))}},{key:"sendExceptForError",value:function(t,e){var n=Object.assign({},e);n.info=Object.assign({},e.info||{},{msg:t.message,stack:t.stack}),this.sendExcept(n)}},{key:"getPerformanceTimingInfo",value:function(h){if(window.performance&&window.performance.timing){var v=window.performance.timing,t=function d(){setTimeout(function(){if(v.loadEventEnd&&0<v.loadEventEnd){var t=v.navigationStart,e=v.requestStart,n=v.responseStart,r=v.responseEnd,o=v.domContentLoadedEventStart,i=v.domComplete,a=v.domLoading,c=v.domainLookupStart,u=v.domainLookupEnd,f=v.connectStart,s=v.connectEnd,l=v.loadEventStart,p=v.loadEventEnd;h({dns:u-c,tcp:s-f,req:n-e,res:r-n,dct:i-a,load:p-l,domready:o-t,finish:p-t})}else d()},200),window.removeEventListener("load",d)};v.loadEventEnd&&0<v.loadEventEnd?t():window.addEventListener("load",t)}else h()}},{key:"listenGlobalError",value:function(t){t&&(this.listenErrorOption=t),window.removeEventListener("error",this.globalErrorCallback),window.addEventListener("error",this.globalErrorCallback)}},{key:"unListenGlobalError",value:function(){window.removeEventListener("error",this.globalErrorCallback),this.listenErrorOption={}}},{key:"startMark",value:function(t){this.markCache[t]={start:Date.now()}}},{key:"endMark",value:function(t){return this.markCache[t]?(this.markCache[t].total=Date.now()-this.markCache[t].start,this.markCache[t].total):0}},{key:"clearMark",value:function(t){this.markCache[t]&&delete this.markCache[t]}},{key:"getAllMark",value:function(){for(var t={},e=0,n=Object.keys(this.markCache);e<n.length;e++){var r=n[e];t[r]=this.markCache[r].total}return t}},{key:"clearAllMark",value:function(){this.markCache={}}},{key:"globalErrorCallback",value:function(t){var e=t.error||{},n=Object.assign({},this.listenErrorOption);n.info=Object.assign({},this.listenErrorOption.info||{},{msg:t.message,colno:t.colno||t.column||window.event&&window.event.errorCharacter,lineno:t.lineno||t.line,filename:t.filename||t.sourceURL,stack:e.stack}),this.sendExcept(n)}}])&&Be(Ue.prototype,Ke),void($e&&Be(Ue,$e)),Xe});
